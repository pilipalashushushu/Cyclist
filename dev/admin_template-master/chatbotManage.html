<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <title>CYCLIST 機器人管理</title>
  <!-- Icons-->
  <link href="node_modules/@coreui/icons/css/coreui-icons.min.css" rel="stylesheet">
  <link href="node_modules/flag-icon-css/css/flag-icon.min.css" rel="stylesheet">
  <link href="node_modules/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <link href="node_modules/simple-line-icons/css/simple-line-icons.css" rel="stylesheet">
  <!-- Main styles for this application-->
  <link href="css/style.css" rel="stylesheet">
</head>

<body class="app header-fixed sidebar-fixed aside-menu-fixed sidebar-lg-show">
 <!-- top_header -->
 <header class="app-header navbar">
    <button class="navbar-toggler sidebar-toggler d-lg-none mr-auto" type="button" data-toggle="sidebar-show">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="blank.html">
      <img class="navbar-brand-full" src="img/brand/LOGO.png" width="55" height="42" alt="Cyclist Logo">
      <img class="navbar-brand-minimized" src="img/brand/LOGO.png" width="30" height="30" alt="Cyclist Logo">
    </a>
    <button class="navbar-toggler sidebar-toggler d-md-down-none" type="button" data-toggle="sidebar-lg-show">
      <span class="navbar-toggler-icon"></span>
    </button>
    <ul class="nav navbar-nav ml-auto">
        <li class="nav-item mr-3 adminName"></li>
        <a class="nav-item mr-3 logOut" href="login.html">登出</a>
      </ul>
    <button class="navbar-toggler aside-menu-toggler d-lg-none" type="button" data-toggle="aside-menu-show">
      <span class="navbar-toggler-icon"></span>
    </button>
  </header>
  <div class="app-body">
    <div class="sidebar">
      <!-- sidebar menu-->
      <nav class="sidebar-nav">
    <ul class="nav">
      <li class="nav-title" style="font-size:22px;">後台管理</li>
      <li class="nav-item">
          <a class="nav-link" href="adminManage.html">
            <i class="nav-icon icon-settings"></i>管理員管理</a>
      </li>
      <li class="nav-item">
          <a class="nav-link" href="accountManage.html">
            <i class="nav-icon icon-people"></i>會員管理</a>
        </li>
      <li class="nav-item">
          <a class="nav-link" href="productManage.html">
            <i class="nav-icon icon-heart"></i>商品管理</a>
        </li>
      <li class="nav-item">
          <a class="nav-link" href="orderManage.html">
            <i class="nav-icon icon-basket-loaded"></i>訂單管理</a>
      </li>
      <li class="nav-item">
          <a class="nav-link" href="customizeManage.html">
            <i class="nav-icon icon-wrench"></i>客製管理</a>
      </li>
      <li class="nav-item">
          <a class="nav-link" href="activityManage.html">
            <i class="nav-icon icon-calendar"></i>活動管理</a>
      </li>
      <li class="nav-item">
          <a class="nav-link" href="activityReport.html">
            <i class="nav-icon icon-calendar"></i>活動檢舉</a>
      </li>
      <li class="nav-item">
          <a class="nav-link" href="chatbotManage.html">
            <i class="nav-icon icon-info"></i>機器人管理</a>
      </li>
    </ul>
  </nav>
      <button class="sidebar-minimizer brand-minimizer" type="button"></button>
    </div>
    <main class="main">
      <!-- Breadcrumb-->
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="blank.html">首頁</a>
        </li>
        <li class="breadcrumb-item">
            <a href="chatbotManage.html">機器人管理</a>
        </li>
        <!-- Breadcrumb Menu-->
      </ol>
      <div class="container-fluid">
       <!-- 中間內容 -->
     <div class="col-md-12">
       <div class="row chatRow">
          <div class="col-lg-4 ">  
              <div class="card">
                  <div class="card-header">問題編號</div>
                  <div class="card-body">
                      <form action="" method="POST" enctype="multipart/form-data" id="chatAdd">
                        <table class="table table-responsive-sm table-sm">
                            <tr>
                                <th>問題關鍵字</th>
                                <td>
                                    <input class="form-control cskey" type="text" name="csKey">
                                </td>
                            </tr>
                            <tr>
                                <th>問題的回答</th>
                                <td>
                                    <textarea class="form-control csAns" rows="3" name="csAns"></textarea>
                                </td>
                            </tr>
                            
                        </table>
                        <div class="row">
                            <div class="col-6 col-sm-4 col-md-2 col-xl mb-3 mb-xl-0">
                                <button class="btn btn-pill btn-block btn-primary csAdd" type="submit"">確認新增</button>
                            </div>
                            <div class="col-6 col-sm-4 col-md-2 col-xl mb-3 mb-xl-0">
                                <button class="btn btn-pill btn-block btn-secondary" type="reset">清除內容</button>
                            </div>
                        </div>
                      </form>
                  </div>
              </div>
          </div>
          
         
        </div>
    </div>

       <!-- end -->
      </div>
    </main>
  </div>
        <footer class="app-footer">
        <div>
          <a href="http://140.115.236.71/demo-projects/DD103/DD103G4/">CYCLIST</a>
          <span>&copy; 2019 copyright</span>
        </div>
      </footer>
  <!-- CoreUI and necessary plugins-->
  <script src="node_modules/jquery/dist/jquery.min.js"></script>
  <script src="node_modules/popper.js/dist/umd/popper.min.js"></script>
  <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="node_modules/pace-progress/pace.min.js"></script>
  <script src="node_modules/perfect-scrollbar/dist/perfect-scrollbar.min.js"></script>
  <script src="node_modules/@coreui/coreui/dist/js/coreui.min.js"></script>
  <script>
    $('document').ready(function(){
            function chatManage(){
            let xhr = new XMLHttpRequest();
            xhr.onload = function(){
            if(xhr.status == 200){ //server OK
                let dataString = JSON.parse(xhr.responseText);
                let htmlStr = '';
                for (i = 0; i < dataString.length; i++) {
                        htmlStr = '';
                        htmlStr += `<div class="col-lg-4">`;
                        htmlStr += `<div class="card">`;
                        htmlStr += `<div class="card-header">問題編號<span class="chatChange">${dataString[i].csNo}</span></div>`;
                        htmlStr += `<div class="card-body">`;
                        htmlStr += `<form action="" method="get" enctype="multipart/form-data" id="chatAdd" >`;
                        htmlStr += `<table class="table table-responsive-sm table-sm">`;
                        htmlStr += `<tr><th>問題關鍵字</th><td>${dataString[i].csKey}</td></tr>`;
                        htmlStr += `<tr><th>問題的回答</th><td>${dataString[i].csAns}</td></tr>`;
                        htmlStr += `</table>`;
                        htmlStr +=`<div class="col-6 col-sm-4 col-md-2 col-xl mb-3 mb-xl-0">
                                        <button class="btn btn-pill btn-block btn-primary delChat" type="button">刪除</button>
                                   </div>`                    
                        htmlStr += `</form></div></div></div>`;  
                        $('.chatRow').append(htmlStr);                    
                }  
            }else{ //error
                alert(xhr.status);
            }
            } //xhr function end
            xhr.open("get", "./php/chatManage.php", true);
            // xhr.setRequestHeader("content-type", "application/x-www-form-urlencoded");
            xhr.send( null );
            }
            chatManage();

    //-----------------------------------
                //del -- start --
            $('body').on('click', '.delChat', function (){
                let csNo =$(this).parent().parent().parent().parent().find('.chatChange').text();
                let delColumn = this;
                // alert(csNo);
                // $(this).parents().find('.chatDelete').remove();
                $.ajax({
                    type:'POST',
                    url:`./php/chatDelete.php`,
                    data:{
                        csNo:csNo,
                    },
                    success:function(deleteBack){
                        alert('刪除成功');
                        $(delColumn.parentElement.parentElement.parentElement.parentElement).remove();
                    },
                    error: function () {
                        alert('fail');
                    }
                })
            });  //del -- end --
    //--------------------------------------
                //add -- start --
                $("#chatAdd").on('submit',(function(e){
                    e.preventDefault();
                    $.ajax({
                        url: "./php/chatAdd.php",
                        type: "POST",
                        data:  new FormData(this),
                        contentType: false,
                        cache: false,
                        processData:false,
                        success: function(data){
                            alert("新增成功");
                            location.reload();   
                        },
                        error: function(data){
                            alert("新增失敗");
                        }               
                    });
                }));



    }); //function ready-end        
</script>
</body>
</html>